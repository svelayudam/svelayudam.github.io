I"‚L<p>I recently transitioned from writing my posts directly in markdown to writing them in
<a href="https://orgmode.org/">org mode</a>, a document authoring system built in GNU Emacs. I learned a lot in the
process, and also built a new org exporter in the process, <a href="https://github.com/peterewills/ox-jekyll-lite"><code class="language-plaintext highlighter-rouge">ox-jekyll-lite</code>.</a><sup id="fnref:fn1" role="doc-noteref"><a href="#fn:fn1" class="footnote" rel="footnote">1</a></sup></p>

<h1 id="org-mode-and-the-meaning-of-life">Org Mode and the Meaning of Life</h1>

<h2 id="what-is-org-mode">What is Org Mode?</h2>

<p>Laozi said that the Tao that can be told is not the eternal Tao; I think we can safely
say the same of org mode. Org mode is many things to many people, but at it‚Äôs core it is
a tool for taking notes and organizing lists. Additional functionality allows for simple
text markup, links, inline images, rendered \(\LaTeX\) fragments, and so on. You can embed
and run code blocks within org files, using the powerful <a href="https://orgmode.org/worg/org-contrib/babel/"><code class="language-plaintext highlighter-rouge">org-babel</code></a> package. Some
people have even <a href="https://write.as/dani/writing-a-phd-thesis-with-org-mode">written
their Ph.D. thesis in org mode</a>. It‚Äôs an amazingly powerful tool, with a passionate
user base that is constantly expanding its capabilities.</p>

<h2 id="why-not-markdown">Why Not Markdown?</h2>

<p>I like to use org mode for my personal and professional note-taking because it has very
good folding features - you can hide all headings besides the one you‚Äôre focusing
on. You can even ‚Äúnarrow‚Äù your buffer, so that only the heading (‚Äúsubtree‚Äù, in org-mode
parlance) that you‚Äôre working on is present at all.</p>

<p>Org mode also has some nice visual features for writing, such as:</p>

<ul>
  <li>rendering \(\LaTeX\) fragments inline</li>
  <li>styling <strong>bold</strong>, <u>underlined</u>, and <em>italicized</em> text properly</li>
  <li>excellent automatic formatting of tables</li>
  <li>code syntax highlighting in various languages</li>
  <li>display of images inline</li>
</ul>

<p>I wrote in markdown (using <code class="language-plaintext highlighter-rouge">markdown-mode</code> within emacs) for some time, but once I saw
what org mode had to offer, I realized that I needed to transfer my blogging over to
org. In particular, the Emacs mode <code class="language-plaintext highlighter-rouge">markdown-mode</code> doesn‚Äôt have a lot of the features that
org mode does, such as inline rendering of math and images or well-built text folding. I
used org for notes, and I realized that it would be much easier to just write in org
instead of trying to get markdown mode to work the way I want it to.</p>

<p>Below is a short clip that shows just some of what org mode has to offer. You‚Äôll
want to full-screen it to make the text legible.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/MV9LR2LCxAE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
<p>¬†</p>

<p>Overall, I find the experience of writing in org much more enjoyable than writing in
markdown. Plus, I love hacking on emacs, and moving my blogging workflow over to org
presented me with an opportunity to do just that! So of course, I couldn‚Äôt resist.</p>

<h1 id="org-export-and-jekyll">Org-Export and Jekyll</h1>

<h2 id="blogging-in-jekyll">Blogging in Jekyll</h2>

<p>The primary tool I use to generate my blog is a static-site generator called <a href="https://jekyllrb.com/">Jekyll</a>,
which is written in Ruby. I wrote <a href="/_posts/2017-12-29-website.md">a previous post</a> describing my process for setting up
my site. <a href="https://blog.getpelican.com/">Pelican</a> is a similar tool written in Python, and <a href="https://gohugo.io/">Hugo</a> is a
static-site generator written in Go. We‚Äôll talk a bit more about Hugo later.</p>

<p>All of these tools allow the user to write content in simple markdown, with the site
generator doing most of the heavy lifting in generating a full static site behind the
scenes. In Jekyll, the user provided some basic configuration for each post, like a
title, date, and excerpt, and then the them determines the details on how the text is
rendered into fully styled HTML. I use the excellent <a href="https://mmistakes.github.io/minimal-mistakes/">minimal mistakes</a> theme.</p>

<p>Unfortunately, markdown is not a nicely unified language specification There are many
dialects of markdown, and each has subtle differences, so there is not, in general, one
markdown specification to rule them all. For example, so-called ‚ÄúGitHub-flavored
markdown‚Äù, which renders markdown from READMEs in GitHub repositories, has certian
quirks that are not shared by the markdown I write for this site. To further complicate
things, the static site generators often have their own quirks - Jekyll requires
particularly-formatted front-matter to specify the configuration for each post, which is
not part of the general markdown specification.</p>

<p>All that is to say, it wasn‚Äôt a trivial task to find something that converted org to the
exact markdown that I need for my site. But before we jump into the details there, we
should talk a bit about org exporters in general.</p>

<h2 id="org-export">Org-Export</h2>

<p>Org mode comes packaged with many built-in ‚Äúexporters‚Äù, which convert from the org
format to other text formats, including HTML, \(\LaTeX\), iCalendar, and more. It <em>does</em>
come with a backend that converts org to markdown, which I hoped would be all that I
need to convert org to markdown.</p>

<p>Unfortunately, the built-in <code class="language-plaintext highlighter-rouge">ox-md</code> exporter doesn‚Äôt work very well, for a few reasons. It
falls back on using pure HTML (for example, to generate footnotes) when there are
markdown-native ways of accomplishing the same thing. Also, some things don‚Äôt work at
all - for example, equation exporting won‚Äôt work, since markdown requires you to enclose
LaTeX with <code class="language-plaintext highlighter-rouge">\\[</code> and <code class="language-plaintext highlighter-rouge">\\]</code>, whereas HTML only requires a single slash.<sup id="fnref:fn2" role="doc-noteref"><a href="#fn:fn2" class="footnote" rel="footnote">2</a></sup></p>

<p>A quick search will show that there are many tools built to address this problem. Org
exporter backends are designed to be easy to extend, and many users have extended the
markdown backend to work with specific static site generators. The most fully developed
of these is <a href="https://ox-hugo.scripter.co/"><code class="language-plaintext highlighter-rouge">ox-hugo</code></a>, which is built to work with the site generator Hugo. This
package in particular would be a big source of the transcoding functions I would use,
but since it is built to be tightly integrated with Hugo, I couldn‚Äôt just use it out of
the box.</p>

<p>Elsa Gonsiorowski developed a Jekyll-friendly org exporter, called <a href="https://www.gonsie.com/blorg/ox-jekyll.html"><code class="language-plaintext highlighter-rouge">ox-jekyll-md</code></a>, which
provided the basis for what I would eventually build. She also wrote <a href="https://www.gonsie.com/blorg/ox-jekyll.html">a blog post</a> about
it - if you‚Äôre interested in customizing org exported, I‚Äôd recommend giving it a read.</p>

<h2 id="building-ox-jekyll-lite">Building <code class="language-plaintext highlighter-rouge">ox-jekyll-lite</code></h2>

<p>There are some things that <code class="language-plaintext highlighter-rouge">ox-jekyll-md</code> does very well, including generating the
Jekyll-specific YAML front matter. However, I found that it lacks a few key features:</p>

<ul>
  <li>handling footnotes in a markdown-native way</li>
  <li>rendering MathJax delimiters with double slashes (to make them markdown-compatable)</li>
  <li>exporting image links appropriately</li>
  <li>export link paths relative to the Jekyll root directory</li>
</ul>

<p>Since these were essential to my blogging workflow, I forked that project and began work
on my org exporter, <a href="https://github.com/peterewills/ox-jekyll-lite"><code class="language-plaintext highlighter-rouge">ox-jekyll-lite</code></a>.</p>

<h3 id="customizing-an-org-export-backend">Customizing an Org Export Backend</h3>

<p>You can think of an org-export backend as a collection of rules for transforming org
files into other text format. For example, how should underlined text be handled? How
about code blocks? How about \(\LaTeX\) snippets? Each of these rules is encapsulated by a
so-called ‚Äútranscoding function.‚Äù</p>

<p>Org export backends are built to be highly extensible. If you extend <code class="language-plaintext highlighter-rouge">ox-md</code>, for example,
then you ‚Äúinherit‚Äù all the transcoding functions that it provides, and you can add or replace
only the functions you want to. For example, part of <code class="language-plaintext highlighter-rouge">ox-jekyll-lite</code> looks like</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">org-export-define-derived-backend</span> <span class="ss">'jekyll</span> <span class="ss">'md</span>
  <span class="ss">:translate-alist</span>
  <span class="o">'</span><span class="p">((</span><span class="nv">headline</span> <span class="o">.</span> <span class="nv">org-jekyll-lite-headline-offset</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">inner-template</span> <span class="o">.</span> <span class="nv">org-jekyll-lite-inner-template</span><span class="p">)))</span> 
</code></pre></div></div>

<p>This tells us that we‚Äôre defining a backend named <code class="language-plaintext highlighter-rouge">jekyll</code>, which derives from the backend
named <code class="language-plaintext highlighter-rouge">md</code> (which, if you look, itself derives from the <code class="language-plaintext highlighter-rouge">html</code> backend).</p>

<p>In the code above, the <code class="language-plaintext highlighter-rouge">translate-alist</code> indicates that this backend handles <code class="language-plaintext highlighter-rouge">headline</code>
objects via the <code class="language-plaintext highlighter-rouge">org-jekyll-lite-headline-offset</code> method, and handles the <code class="language-plaintext highlighter-rouge">inner-template</code>
object via <code class="language-plaintext highlighter-rouge">org-jekyll-lite-inner-template</code>. These functions take in org elements,
returning text that will get dumped into the export buffer.</p>

<p>The transcoding function <code class="language-plaintext highlighter-rouge">org-jekyll-lite-underline</code> is a particularly simple example:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-jekyll-lite-underline</span> <span class="p">(</span><span class="nv">underline</span> <span class="nv">contents</span> <span class="nv">info</span><span class="p">)</span>
  <span class="s">"Transcode UNDERLINE from Org to Markdown.
CONTENTS is the text with underline markup.  INFO is a plist
holding contextual information."</span>
  <span class="p">(</span><span class="nb">format</span> <span class="s">"&lt;u&gt;%s&lt;/u&gt;"</span> <span class="nv">contents</span><span class="p">))</span>
</code></pre></div></div>

<p>Extending a backend consists of figuring out which elements you want to handle via
special logic, then writing the appropriate transcoding functions for each.</p>

<h3 id="implementation-details-for-ox-jekyll-lite">Implementation Details for <code class="language-plaintext highlighter-rouge">ox-jekyll-lite</code></h3>

<p>Most of the more complicated transcoding functions in <code class="language-plaintext highlighter-rouge">ox-jekyll-lite</code> are not written by
me. They either come from <code class="language-plaintext highlighter-rouge">ox-jekyll-md</code>, or from <code class="language-plaintext highlighter-rouge">ox-hugo</code>. For example, I got the
transcoder for footnotes, and for \(\LaTeX\) snippets, from <code class="language-plaintext highlighter-rouge">ox-hugo</code>.</p>

<p>The most interesting addition that I made was to render file links relative to the root
directory of Jekyll, when possible. For example, if you have an image in your
<code class="language-plaintext highlighter-rouge">assets/images</code> folder, Jekyll wants you to link to it as <code class="language-plaintext highlighter-rouge">/assets/images/kitties.jpg</code>, not
with the full path relative to the root directory of your computer‚Äôs filesystem.</p>

<p>However, when I use <code class="language-plaintext highlighter-rouge">C-c C-l</code> (along with Helm) to add a link to an org file, it renders
the link with the absolute path.<sup id="fnref:fn3" role="doc-noteref"><a href="#fn:fn3" class="footnote" rel="footnote">3</a></sup> It‚Äôs important that the link is ‚Äúcorrect‚Äù for my
machine, so that any images can render inline, and the links are clickable by me when
from my orgfile. But if the links are relative to my filesystem‚Äôs root in the markdown,
then they won‚Äôt work within the context of my site. So, we need to ‚Äúfix‚Äù the links as we
export the post to markdown.</p>

<p>I don‚Äôt get too complicated here - I just have the user specify a custom variable
<code class="language-plaintext highlighter-rouge">org-jekyll-project-root</code>, which then gets pulled off of the beginning of file paths when
it is present.</p>

<p>For example, on my machine, this repository is located at
<code class="language-plaintext highlighter-rouge">~/code/jekyll/peterewills.github.io/</code>, and so if I link to the file
<code class="language-plaintext highlighter-rouge">~/code/jekyll/peterewills.github.io/assets/images/kitties.jpg</code> in my org file,
<code class="language-plaintext highlighter-rouge">ox-jekyll-lite</code> will, upon export, transform this to a link to <code class="language-plaintext highlighter-rouge">/assets/images/kitties.jpg</code>
in the markdown output. This approach is nice and simple, but it doesn‚Äôt handle relative
links, or the situation where you have multiple Jekyll projects.</p>

<p>Anyways, if you want to give it a try, you can clone it <a href="https://github.com/peterewills/ox-jekyll-lite">from GitHub</a> and check it
out. You can just load it up and use <code class="language-plaintext highlighter-rouge">C-c C-e j J</code> to export an org file to a markdown
buffer.</p>

<p>Finally, as a side note, I just have to give a shoutout to the excellent <a href="https://github.com/magnars/s.el"><code class="language-plaintext highlighter-rouge">s.el</code></a> and
<a href="https://github.com/magnars/dash.el"><code class="language-plaintext highlighter-rouge">dash</code></a>, which makes working in elisp infinitely more pleasant. Many thanks to Magnar
Sveen for building such nice tools for us all to use.</p>

<h1 id="my-blogging-workflow">My Blogging Workflow</h1>

<p>Now, my workflow for writing a post is pretty simple.</p>

<ol>
  <li>Have brilliant idea</li>
  <li>Make an org file in the <code class="language-plaintext highlighter-rouge">_posts</code> directory, named like <code class="language-plaintext highlighter-rouge">YYYY-MM-DD-post-name.org</code></li>
  <li>Write brilliant words/equations/cat pictures/etc.</li>
  <li>Export to markdown via <code class="language-plaintext highlighter-rouge">C-c C-e j j</code></li>
  <li>Commit &amp; push to GitHub</li>
  <li>Profit!<sup id="fnref:fn4" role="doc-noteref"><a href="#fn:fn4" class="footnote" rel="footnote">4</a></sup></li>
</ol>

<p>The only additional complication, compared to a pure-markdown workflow, is the addition
of the export step; other than that, it‚Äôs identical. And now I can blog in wonderful,
beautiful org mode instead of clunky markdown.</p>

<p>An important caveat for anyone using org and Jekyll; in order to not have Jekyll stumble
over the org artifacts, you should add <code class="language-plaintext highlighter-rouge">*.org</code> and <code class="language-plaintext highlighter-rouge">ltximg</code> to the <a href="https://github.com/peterewills/peterewills.github.io/blob/master/_config.yml#L13-L17">list of excluded files</a> in
your Jekyll <code class="language-plaintext highlighter-rouge">_config.yml</code>. You can see mine <a href="https://github.com/peterewills/peterewills.github.io/blob/master/_config.yml">on GitHub</a>.</p>

<h1 id="conclusion">Conclusion</h1>

<p>If you are just starting to blog, and you love org mode, I‚Äôd recommend using Hugo to
build your site, so that you can use the excellent <code class="language-plaintext highlighter-rouge">ox-hugo</code>. It‚Äôs a truly org-centric
approach to building a static site, and it‚Äôs much more fully-featured than any of the
solutions I‚Äôve found in Jekyll or Pelican.</p>

<p>But, you might want to use Jekyll, because it integrates automagically with GitHub
pages, or perhaps you just like some of the available themes or whatnot. If that‚Äôs the
case, then I think <code class="language-plaintext highlighter-rouge">org-jekyll-lite</code> is a reasonable solution for writing your posts in
org. It‚Äôs lightweight, and you‚Äôll probably have to tweak it to fit your particular
needs, but it‚Äôs small enough that modifying it shouldn‚Äôt be too hard. Also, you can
always submit an issue on GitHub and I‚Äôll see if I can help you out.</p>

<p>I hope this post has inspired you to explore more in org mode! It‚Äôs a great tool for
organizing notes, tracking agendas/calendars/TODO lists, and for general
writing.<sup id="fnref:fn5" role="doc-noteref"><a href="#fn:fn5" class="footnote" rel="footnote">5</a></sup> Happy blogging, and may the org be with you!</p>

<!----- Footnotes ----->

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:fn1" role="doc-endnote">
      <p>As I explain later on, this tool was based on both <a href="https://github.com/gonsie/ox-jekyll-md"><code class="language-plaintext highlighter-rouge">ox-jekyll-md</code></a> and <a href="https://ox-hugo.scripter.co/"><code class="language-plaintext highlighter-rouge">ox-hugo</code></a>.¬†<a href="#fnref:fn1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn2" role="doc-endnote">
      <p>The double slash is required because markdown interprets the first slash as an escape character.¬†<a href="#fnref:fn2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn3" role="doc-endnote">
      <p>You can see an example of adding a link to an image in the org-mode demo video linked above.¬†<a href="#fnref:fn3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn4" role="doc-endnote">
      <p>This is actually a lie; I don‚Äôt make any money from this site.¬†<a href="#fnref:fn4" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn5" role="doc-endnote">
      <p>There‚Äôs also the entire subject of <a href="http://cachestocaches.com/2018/6/org-literate-programming/">literate programming</a>, in which code is interwoven with documentation, which I think is a really nice paradigm, and for which org is a natural fit.¬†<a href="#fnref:fn5" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
:ET